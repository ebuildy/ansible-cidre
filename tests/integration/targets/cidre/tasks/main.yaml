---

- name: List projects
  community.cidre.gitlab_api:
    resource: projects

- block:
  - name: get get_projects
    community.cidre.gitlab_api:
      resource: projects
      context:
        search: cidre-test
    register: get_projects
  - debug:
      var: get_projects

- block:
  - set_fact:
      g_project: "{{ lookup('community.cidre.gitlab_project', 'cidre-test') }}"
    ignore_errors: yes
  - when: g_project is defined
    block:
    - debug:
        msg: "project = {{ g_project.id }}"
    - community.cidre.gitlab_api:
        action: delete
        context:
          project: "{{ g_project.id }}"

- block:
  - name: Create test project
    community.cidre.gitlab_api:
      resource: projects
      data:
        name: cidre-test
        description: "Test ansible cidre collection"
      action: create
    register: g_project
  - debug:
      msg: "project = {{ g_project.id }}"

- name: Create some issues
  community.cidre.gitlab_api:
    resource: issues
    data:
      title: Test create issue
    action: create
